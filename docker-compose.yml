# ================================
# ğŸ³ Docker Compose è¨­å®šï¼ˆSupabaseãƒ­ãƒ¼ã‚«ãƒ«æ¥ç¶šç”¨ï¼‰
# ================================
# Supabase CLIï¼ˆsupabase startï¼‰ã§èµ·å‹•ã—ãŸDBã‚’åˆ©ç”¨ã—ã€
# Dockerä¸Šã§ã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆReactï¼‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆRailsï¼‰ã®ã¿ã‚’èµ·å‹•ã™ã‚‹æ§‹æˆã€‚

version: "3.9"

services:
  # -------------------------------
  # Rails API ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
  # -------------------------------
  backend:
    build: ./backend
    ports:
      - "3000:3000"  # Rails APIã‚µãƒ¼ãƒãƒ¼ (localhost:3000)
    environment:
      RAILS_ENV: development
      # Dockerå†…ã‹ã‚‰ãƒ›ã‚¹ãƒˆã®Supabaseã«æ¥ç¶š
      DATABASE_URL: postgres://postgres:postgres@host.docker.internal:54322/app_development
    volumes:
      - ./backend:/app  # ãƒ­ãƒ¼ã‚«ãƒ«ã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚¦ãƒ³ãƒˆã—ã¦ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰
    env_file:
      - ./backend/.env  # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å°‚ç”¨ã®.envãƒ•ã‚¡ã‚¤ãƒ«
    command: bash -c "rm -f tmp/pids/server.pid && bundle install && rails s -b 0.0.0.0"

  # -------------------------------
  # React / Vite ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
  # -------------------------------
  frontend:
    build: ./frontend
    ports:
      - "5173:5173"  # Viteé–‹ç™ºã‚µãƒ¼ãƒãƒ¼ (localhost:5173)
    environment:
      # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã¨ã®é€šä¿¡å…ˆ
      VITE_API_BASE_URL: http://localhost:3000
      # Supabaseè¨­å®š
      VITE_SUPABASE_URL: http://localhost:54321
      VITE_SUPABASE_ANON_KEY: dummy
    volumes:
      - ./frontend:/app
      - /app/node_modules
    env_file:
      - ./frontend/.env  # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å°‚ç”¨ã®.envãƒ•ã‚¡ã‚¤ãƒ«
    command: sh -c "npm install && npm run dev -- --host 0.0.0.0"

# DBã‚µãƒ¼ãƒ“ã‚¹ã¯å‰Šé™¤ï¼ˆSupabaseãƒ­ãƒ¼ã‚«ãƒ«PostgreSQLã‚’ä½¿ç”¨ï¼‰
