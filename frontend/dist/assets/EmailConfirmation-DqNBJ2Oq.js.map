{"version":3,"file":"EmailConfirmation-DqNBJ2Oq.js","sources":["../../src/features/auth/pages/EmailConfirmation.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport { useSearchParams, useNavigate } from 'react-router-dom';\nimport { Button } from '../../../components/ui/button';\nimport { Seo } from '../../../components/layout/Seo';\n\n// =======================================\n// Component\n// =======================================\n// メール確認リンクから遷移し、結果に応じたメッセージと遷移を提供する\nexport function EmailConfirmation() {\n  const [searchParams] = useSearchParams();\n  const navigate = useNavigate();\n  const [status, setStatus] = useState<'loading' | 'success' | 'error'>(\n    'loading',\n  );\n  const [message, setMessage] = useState('');\n\n  // マウント時にトークンを取得し、確認APIを叩く\n  useEffect(() => {\n    const confirmationToken = searchParams.get('confirmation_token');\n\n    if (!confirmationToken) {\n      setStatus('error');\n      setMessage('確認トークンが見つかりません。');\n      return;\n    }\n\n    // メールアドレス確認APIを呼び出す\n    const confirmEmail = async () => {\n      try {\n        const response = await fetch(\n          `${import.meta.env.VITE_API_BASE_URL}/api/v1/confirmation?confirmation_token=${confirmationToken}`,\n          {\n            method: 'GET',\n            headers: {\n              'Content-Type': 'application/json',\n            },\n          },\n        );\n\n        const data = await response.json();\n\n        if (response.ok) {\n          // JWTトークンをAuthorizationヘッダーから取得\n          const authHeader = response.headers.get('Authorization');\n          if (authHeader) {\n            const token = authHeader.replace('Bearer ', '');\n            localStorage.setItem('auth_token', token);\n          }\n\n          setStatus('success');\n          setMessage(\n            'メールアドレスの認証が完了しました。ホーム画面へリダイレクトします。',\n          );\n\n          // 2秒後にホームへリダイレクト（完全リロード）\n          setTimeout(() => {\n            window.location.href = '/';\n          }, 2000);\n        } else {\n          setStatus('error');\n          setMessage(data.status?.message || '確認に失敗しました。');\n        }\n      } catch (error) {\n        setStatus('error');\n        setMessage('確認中にエラーが発生しました。');\n        // エラーログ\n        if (error instanceof Error) {\n          setMessage(error.message);\n        }\n      }\n    };\n\n    confirmEmail();\n  }, [searchParams]);\n\n  const confirmationStructuredData = {\n    '@context': 'https://schema.org',\n    '@type': 'WebPage',\n    name: \"メール確認 | Today's Cocktail\",\n    description: 'ユーザーのメールアドレス確認状態を表示するページ',\n  };\n\n  return (\n    <>\n      <Seo\n        title=\"メール確認\"\n        description=\"メールアドレスの認証が完了するとホーム画面にリダイレクトします。\"\n        path=\"/confirmation\"\n        noindex\n        structuredData={confirmationStructuredData}\n      />\n      <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100 p-4\">\n        <div className=\"max-w-md w-full bg-white rounded-2xl shadow-xl p-8\">\n          {/* ローディング表示 */}\n          {status === 'loading' && (\n            <div className=\"text-center\">\n              <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\n              <p className=\"text-gray-600\">確認中...</p>\n            </div>\n          )}\n\n          {/* 完了表示 */}\n          {status === 'success' && (\n            <div className=\"text-center\">\n              <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n                <svg\n                  className=\"w-8 h-8 text-green-600\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth={2}\n                    d=\"M5 13l4 4L19 7\"\n                  />\n                </svg>\n              </div>\n              <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">\n                確認完了\n              </h2>\n              <p className=\"text-gray-600 mb-6\">{message}</p>\n              <Button onClick={() => navigate('/')} className=\"w-full\">\n                ホームへ戻ってログイン\n              </Button>\n            </div>\n          )}\n\n          {/* エラー表示 */}\n          {status === 'error' && (\n            <div className=\"text-center\">\n              <div className=\"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n                <svg\n                  className=\"w-8 h-8 text-red-600\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth={2}\n                    d=\"M6 18L18 6M6 6l12 12\"\n                  />\n                </svg>\n              </div>\n              <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">\n                確認失敗\n              </h2>\n              <p className=\"text-gray-600 mb-6\">{message}</p>\n              <Button\n                onClick={() => navigate('/')}\n                variant=\"outline\"\n                className=\"w-full\"\n              >\n                ホームへ戻る\n              </Button>\n            </div>\n          )}\n        </div>\n      </div>\n    </>\n  );\n}\n"],"names":["EmailConfirmation","searchParams","useSearchParams","navigate","useNavigate","status","setStatus","useState","message","setMessage","useEffect","confirmationToken","response","data","authHeader","token","error","confirmationStructuredData","jsxs","Fragment","jsx","Seo","Button"],"mappings":"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"}